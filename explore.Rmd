---
title: "explore"
author: "Jake Eisaguirre"
date: "6/28/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(here)
library(tidyverse)
library(janitor)
library(sf)
library(lubridate)
library(leaflet)
library(sp)
```

# VES data
```{r}
ves_data <- read_csv(here("data", "VES.csv")) %>% 
  clean_names()

clean_ves_data <- ves_data %>% 
  dplyr::select(c(id_1, utme, utmn, wilderness, visit_date, visit_status, duration, species, visual_life_stage, 
                  visual_animal_state, count)) %>% 
    mutate(visit_date = year(visit_date)) %>% 
  rename(id = id_1,
         date = visit_date)
```

# bd_load data
```{r}
bd_data <- read_csv(here("data", "bd_load.csv")) %>% 
  clean_names()

clean_bd_data <- bd_data %>% 
  dplyr::select(id_1, utme_11, utmn_12, wilderness, visit_date, visit_status, duration, species, bd_load) %>% 
  mutate(visit_date = year(visit_date)) %>% 
  rename(id = id_1,
         utme = utme_11,
         utmn = utmn_12,
         date = visit_date)



```


```{r}

test <- clean_ves_data %>% 
  filter(id == 10411,
         visual_life_stage == "adult",
         date == 2019)

ggplot(data = test, aes(y = count, x = species)) +
  geom_col()

```


```{r}
sf_ves <- st_as_sf(clean_ves_data, coords = c('utme', 'utmn'), crs = "+proj=utm +zone=11")

leaf_ves = st_transform(sf_ves, crs = "+proj=longlat +ellps=WGS84 +datum=WGS84")


coord <- leaf_ves %>% 
  mutate(long = st_coordinates(.)[,1],
         lat = st_coordinates(.)[,2]) %>% 
  as.data.frame()
```


```{r}

leaf_bd <- clean_bd_data %>% 
  filter(wilderness == "yosemite",
        date == "2019")

leaf_test <- coord %>% 
  filter(wilderness == "yosemite")

leaflet() %>% 
  addProviderTiles("Esri.WorldImagery") %>% 
  addCircleMarkers(lng = leaf_test$long, lat = leaf_test$lat, popup = paste("Site:", leaf_test$id, "<br>",
                                                                            "Bd Load:", leaf_bd$bd_load),
                   color = "blue", radius = 1)

```