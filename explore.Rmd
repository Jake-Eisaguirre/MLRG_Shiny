---
title: "explore"
author: "Jake Eisaguirre"
date: "6/28/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(here)
library(tidyverse)
library(janitor)
library(sf)
library(lubridate)
library(leaflet)
library(sp)
```

# VES data
```{r}
ves_data <- read_csv(here("data", "ves.csv")) %>% 
  clean_names()

clean_ves_data <- ves_data %>% 
  dplyr::select(c(id_1, utme, utmn, wilderness, visit_date, species, visual_life_stage, 
                  visual_animal_state, count)) %>% 
    mutate(visit_date = year(visit_date)) %>% 
  rename(id = id_1,
         date = visit_date) %>% 
  filter(visual_animal_state == "alive",
         visual_life_stage == "adult")


sf_ves <- st_as_sf(clean_ves_data, coords = c('utme', 'utmn'), crs = "+proj=utm +zone=11")

leaf_ves = st_transform(sf_ves, crs = "+proj=longlat +ellps=WGS84 +datum=WGS84")


ves <- leaf_ves %>% 
  mutate(long = st_coordinates(.)[,1],
         lat = st_coordinates(.)[,2]) %>% 
  as.data.frame() %>% 
  dplyr::select(!c(geometry)) %>% 
  group_by(id, date, species, visual_life_stage, visual_animal_state, lat, long, ) %>% 
  summarise(count = sum(count))

write_csv(ves, here("data", "ves_data.csv"))


```

# bd_load data
```{r}
bd_data <- read_csv(here("data", "bd.csv")) %>% 
  clean_names()

clean_bd_data <- bd_data %>% 
  dplyr::select(id_1, utme_11, utmn_12, wilderness, visit_date, species, bd_load) %>% 
  mutate(visit_date = year(visit_date)) %>% 
  rename(id = id_1,
         utme = utme_11,
         utmn = utmn_12,
         date = visit_date)

sf_bd <- st_as_sf(clean_bd_data, coords = c('utme', 'utmn'), crs = "+proj=utm +zone=11")

leaf_bd = st_transform(sf_bd, crs = "+proj=longlat +ellps=WGS84 +datum=WGS84")


bd <- leaf_bd %>% 
  mutate(long = st_coordinates(.)[,1],
         lat = st_coordinates(.)[,2]) %>% 
  as.data.frame() %>% 
  dplyr::select(!c(geometry)) %>% 
  group_by(id, date, species, lat, long, wilderness) %>% 
  summarise(bd = mean(bd_load))

write_csv(bd, here("data", "bd_data.csv"))

shiny_data <- left_join(bd, ves)

write.csv(shiny_data, here("data", "shiny_data.csv"))

```


```{r}

spec <- shiny_data %>% 
  group_by(id, date) %>% 
  filter(visual_life_stage == "adult")
```


```{r}
sf_ves <- st_as_sf(clean_ves_data, coords = c('utme', 'utmn'), crs = "+proj=utm +zone=11")

leaf_ves = st_transform(sf_ves, crs = "+proj=longlat +ellps=WGS84 +datum=WGS84")


coord <- leaf_ves %>% 
  mutate(long = st_coordinates(.)[,1],
         lat = st_coordinates(.)[,2]) %>% 
  as.data.frame() 


```


```{r}

leaf_bd <- clean_bd_data %>% 
  filter(wilderness == "yosemite",
        date == "2019")

leaf_test <- coord %>% 
  filter(wilderness == "yosemite")

leaflet() %>% 
  addProviderTiles("Esri.WorldImagery") %>% 
  addCircleMarkers(lng = leaf_test$long, lat = leaf_test$lat, popup = paste("Site:", leaf_test$id, "<br>",
                                                                            "Bd Load:", leaf_bd$bd_load),
                   color = "blue", radius = 1)

```